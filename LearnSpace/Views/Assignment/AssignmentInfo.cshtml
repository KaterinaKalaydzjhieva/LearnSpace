@model AssignmentInfoViewModel

@{
    ViewBag.Title = "Assignment Details";
    var dueDate = Model.DueDate;
}

<div class="container mt-5">
    <h2 class="mb-4 text-center">@ViewBag.Title</h2>

    <div class="card shadow-lg" style="margin-bottom: 8%;">
        <div class="card-header bg-primary text-white">
            <h4>@Model.Title</h4>
        </div>
        <div class="card-body">
            <p><strong>Class Name:</strong> @Model.ClassName</p>
            <p><strong>Teacher:</strong> @Model.TeacherName</p>
            <p><strong>Description:</strong></p>
            <p class="text-justify">@Model.Description</p>
            <p><strong>Due Date:</strong> @Model.DueDate</p>
            <form asp-controller="Assignment" asp-action="SubmitHomework" method="post" enctype="multipart/form-data">
                <input type="hidden" name="AssignmentId" value="" />
                <div class="file-upload-container d-flex align-items-center">
                    <label class="me-3">Upload File:</label>
                    <input type="file" id="fileInput" class="form-control"  />
                    <span id="uploadMessage" class="ms-3 text-success" style="display: none;">File uploaded</span>
                </div>
                <div id="timeMessage" class="text-danger mt-2"></div>
                <div class="text-center mt-3">
                    <a id="submitButton" class="btn btn-primary" asp-controller="Submission" asp-action="SubmitAssignment" asp-route-file="">Submit</a>
                </div>
            </form>
        </div>
        <div class="card-footer text-center">
            <button onclick="history.back()" class="btn btn-secondary">Back to Assignments</button>
        </div>
    </div>
</div>
<script>
    // Parse the due date from the server-rendered string
    const dueDate = new Date('@dueDate'); // Server-provided due date
    const fileInput = document.getElementById('fileInput');
    const timeMessage = document.getElementById('timeMessage');

    // Check immediately if the due date has passed
    function updateTimer() {
        const now = new Date();
        const timeLeft = dueDate - now;

        if (timeLeft > 0) {
            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            timeMessage.textContent = `Time remaining: ${hours}h ${minutes}m ${seconds}s`;
        } else {
            fileInput.disabled = true;
            timeMessage.textContent = 'Time is up! You can no longer upload a file.';
            clearInterval(timerInterval);
        }
    }
    updateTimer();

    fileInput.addEventListener('change', function () {
        if (fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            submitButton.setAttribute('asp-route-file', fileName);
        } else {
            submitButton.removeAttribute('asp-route-file');
        }
    });

    // Show upload message
    function showUploadMessage() {
        const uploadMessage = document.getElementById('uploadMessage');
        if (fileInput.files.length > 0) {
            const fileName = fileInput.files[0].name;
            uploadMessage.style.display = 'inline';
            uploadMessage.textContent = `File "${fileName}" selected.`;
        } else {
            uploadMessage.style.display = 'none';
        }
    }
</script>